<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ecg_bitalino</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="4_ECG_BiTalino_files/libs/clipboard/clipboard.min.js"></script>
<script src="4_ECG_BiTalino_files/libs/quarto-html/quarto.js"></script>
<script src="4_ECG_BiTalino_files/libs/quarto-html/popper.min.js"></script>
<script src="4_ECG_BiTalino_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="4_ECG_BiTalino_files/libs/quarto-html/anchor.min.js"></script>
<link href="4_ECG_BiTalino_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="4_ECG_BiTalino_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="4_ECG_BiTalino_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="4_ECG_BiTalino_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="4_ECG_BiTalino_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="laboratorio-4-uso-de-bitalino-para-ecg" class="level1">
<h1>“LABORATORIO 4: Uso de BiTalino para ECG”</h1>
<section id="tabla-de-contenidos" class="level2">
<h2 class="anchored" data-anchor-id="tabla-de-contenidos">Tabla de contenidos</h2>
<ol type="1">
<li><a href="#introducción">Introducción</a></li>
<li><a href="#objetivos">Objetivos</a></li>
<li><a href="#materiales-y-equipos">Materiales y equipos</a></li>
<li><a href="#procedimiento">Procedimiento</a></li>
<li><a href="#resultados">Resultados</a>
<ul>
<li><p>5.1 <a href="#51-conexión-usada">Conexión usada</a></p></li>
<li><p>5.2 <a href="#52-video-de-la-señal-y-ploteo-de-la-señal-en-opensignal">Video de la señal y ploteo de la señal en OpenSignal</a></p></li>
<li><p>5.3 <a href="#53-ploteo-de-la-señal-en-python">Ploteo de la señal en Python</a></p></li>
<li><p>5.4 <a href="#54-señal-de-simulación-de-paro-cardiaco---prosim-4">Señal de simulación de paro cardiaco - ProSim 4</a></p></li>
<li><p>5.5 <a href="#55-ploteo-de-la-señal-en-python-de-simulación-de-paro-cardiaco---prosim-4">Ploteo de la señal en Python simulación paro cardiaco - ProSim 4</a></p></li>
<li><p>5.6 <a href="#56-discusiones">Discusiones</a></p></li>
</ul></li>
<li><a href="#conclusiones">Conclusiones</a></li>
<li><a href="#referencias">Referencias</a></li>
</ol>
<hr>
</section>
<section id="introducción" class="level2">
<h2 class="anchored" data-anchor-id="introducción">Introducción</h2>
<p>En este laboratorio, exploramos las ondas del Electrocardiograma (ECG) utilizando BiTalino. Vamos a repasar conceptos básicos para entender de qué va cada parte. Poco a poco aprenderemos de nuestro corazón y de la información que nos da su señal</p>
<section id="conceptos-anatómicos" class="level3">
<h3 class="anchored" data-anchor-id="conceptos-anatómicos">Conceptos Anatómicos</h3>
<p>El corazón es un órgano muscular situado en la cavidad torácica, ligeramente hacia la izquierda del centro del pecho. Se divide en cuatro cámaras: dos aurículas (superiores) y dos ventrículos (inferiores). El corazón está conectado a los vasos sanguíneos, incluidas las arterias, que llevan sangre oxigenada desde el corazón a los tejidos del cuerpo, y las venas, que devuelven la sangre desoxigenada al corazón. Dentro del corazón hay cuatro válvulas: la válvula tricúspide y la válvula mitral entre las aurículas y los ventrículos, y la válvula pulmonar y la válvula aórtica entre los ventrículos y las arterias. [1]</p>
</section>
<section id="conceptos-fisiológicos" class="level3">
<h3 class="anchored" data-anchor-id="conceptos-fisiológicos">Conceptos Fisiológicos</h3>
<p>Ciclo Cardiaco: El ciclo cardíaco es el proceso de contracción y relajación del corazón que permite que la sangre circule por el cuerpo. Se divide en dos fases principales: sístole (contracción) y diástole (relajación).<br><br> Electrofisiología Cardíaca: El corazón tiene un sistema eléctrico que regula su ritmo y función. Esto incluye la generación de impulsos eléctricos en el nodo sinusal, que inicia cada ciclo cardíaco, y la propagación de esos impulsos a través de las células cardiacas, lo que causa la contracción coordinada del corazón.<br><br> Potencial de Acción Cardíaco: Es el cambio eléctrico que ocurre en las células cardiacas durante la despolarización y la repolarización. Durante la despolarización, las células se activan y se contraen, mientras que durante la repolarización, se relajan y se preparan para el siguiente ciclo.<br><br> Registro Electrocardiográfico (ECG): Es una herramienta utilizada para registrar la actividad eléctrica del corazón. Un ECG muestra las ondas que representan la despolarización y repolarización de las diferentes partes del corazón, lo que ayuda a diagnosticar trastornos del ritmo cardíaco y otros problemas cardíacos. [2]</p>
</section>
<section id="patologías-frecuentes" class="level3">
<h3 class="anchored">Patologías frecuentes</h3>
<strong>Enfermedad de las Arterias Coronarias (CAD):</strong> Esta enfermedad se produce cuando las arterias coronarias, que suministran sangre al corazón, se estrechan debido a la acumulación de placa, lo que puede provocar un ataque al corazón o insuficiencia cardíaca. Insuficiencia Cardíaca Congestiva: Es una condición en la que el corazón no puede bombear suficiente sangre para satisfacer las necesidades del cuerpo. Esto puede causar síntomas como fatiga, dificultad para respirar y acumulación de líquido en los pulmones y otras partes del cuerpo. <br> <strong>Enfermedad de las Válvulas Cardíacas:</strong> Las válvulas cardíacas son estructuras que regulan el flujo sanguíneo dentro del corazón. Cuando estas válvulas no funcionan correctamente, pueden surgir problemas como estenosis (estrechamiento de la válvula), regurgitación (fuga de sangre a través de la válvula) o atresia (obstrucción total de la válvula).<br> <strong>Cardiomiopatía:</strong> Se refiere a diversas enfermedades del músculo cardíaco que afectan su capacidad para bombear sangre de manera eficaz. Esto puede llevar a insuficiencia cardíaca y otros problemas cardíacos.<br> <strong>Arritmia Cardíaca:</strong> Es un trastorno en el ritmo cardíaco, donde el corazón puede latir demasiado rápido, demasiado lento o de manera irregular. Esto puede causar mareos, desmayos o incluso ser potencialmente mortal si no se trata adecuadamente.<br> <strong>Pericarditis:</strong> Esta es la inflamación del pericardio, una membrana delgada que rodea el corazón. Puede ser aguda o crónica y puede causar dolor en el pecho y dificultad para respirar. [3]
<div style="text-align: center;">
<img src="./Lab4/Figura_1.jpeg" width="500">
<p>
Figura 1. Patologías del corazón [3]
</p></div>
<section id="electrocardiograma-ecg" class="level3">
<h3 class="anchored">Electrocardiograma (ECG)</h3>
<section id="principios" class="level4">
<h4 class="anchored" data-anchor-id="principios">Principios</h4>
<p>El ECG se genera cuando hay movimiento de iones eléctricos a lo largo del corazón. Representa la dirección promedio de estos impulsos eléctricos. Para su medición se utilizan dos electrodos (como mínimo) para recopilar un vector comparando el potencial de acción. El impulso puede ser positivo o negativo. El corazón tiene un sistema eléctrico que regula su ritmo y función, incluida la generación de impulsos eléctricos en el nodo sinusal y la propagación de estos impulsos a través de las células cardiacas. Durante el ciclo cardiaco, se observan varios vectores eléctricos que representan la activación de diferentes partes del corazón, como las aurículas, el septo ventricular y las paredes ventriculares. [4]</p>
</section>
<section id="componentes-y-ondas-del-ecg" class="level4">
<h4 class="anchored" data-anchor-id="componentes-y-ondas-del-ecg">Componentes y Ondas del ECG</h4>
<p>El ECG consta de varias ondas, incluyendo la onda P (representa la despolarización auricular), el complejo QRS (representa la despolarización ventricular) y la onda T (representa la repolarización ventricular).</p>
</section>
<section id="segmentos-y-intervalos-del-ecg" class="level4">
<h4 class="anchored">Segmentos y Intervalos del ECG</h4>
<p>Se evalúan segmentos e intervalos específicos del ECG, como el intervalo PR (desde el inicio de la onda P hasta el inicio del complejo QRS) y el segmento ST (que indica el período de reposo entre la contracción ventricular y la repolarización).</p>
La interpretación del ECG implica analizar la forma, la amplitud y la duración de las ondas y segmentos para detectar anomalías cardíacas, como arritmias, isquemia y trastornos de la conducción. [4]
<div style="text-align: center;">
<img src="./Lab4/Figura_2.jpeg" width="500">
<p>
Figura 2. Ondas del electrocardiograma [4]
</p></div>
<section id="objetivos" class="level2">
<h2 class="anchored" data-anchor-id="objetivos">Objetivos</h2>
<ul>
<li>Ejecutar una correcta configuración de BiTalino.</li>
<li>Adquirir señales biomédicas de ECG</li>
<li>Adquirir señales del Promsim4</li>
<li>Extraer la información de las señales ECG del software OpenSignals (r)evolution</li>
<li>Entender los cambios fisiológicos que originan la señal ECG.</li>
</ul>
</section>
<section id="materiales-y-equipos" class="level2">
<h2 class="anchored" data-anchor-id="materiales-y-equipos">Materiales y equipos</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>MODELO</th>
<th>DESCRIPCIÓN</th>
<th>CANTIDAD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>( R ) EVOLUTION</td>
<td>Kit BITalino</td>
<td>1</td>
</tr>
<tr class="even">
<td></td>
<td>Laptop o PC</td>
<td>1</td>
</tr>
<tr class="odd">
<td>ProSim</td>
<td>Simulador signos vitales</td>
<td>1</td>
</tr>
<tr class="even">
<td></td>
<td>Electrodos desechables</td>
<td>3</td>
</tr>
</tbody>
</table>
<div style="text-align: center;">
<img src="./Lab4/Figura_3.jpeg" height="300">
<p>
Figura 3. Kit BITalino
</p></div>
<section id="procedimiento" class="level2">
<h2 class="anchored" data-anchor-id="procedimiento">Procedimiento</h2>
<section id="instalación-de-opensignals" class="level3">
<h3 class="anchored" data-anchor-id="instalación-de-opensignals">4.1 Instalación de OpenSignals</h3>
<ul>
<li>Instalar OpenSignals (r)evolution <a href="https://www.pluxbiosignals.com/collections/bitalino/products/bitalino-revolution-boardkit-ble-bt">Descarga aquí</a>
<ul>
<li>Descargar la versión de 64 bits.</li>
</ul></li>
</ul>
</section>
<section id="conexión-del-bitalino-con-opensignals" class="level3">
<h3 class="anchored" data-anchor-id="conexión-del-bitalino-con-opensignals">4.2 Conexión del BITalino con OpenSignals</h3>
<ol type="1">
<li>Activar el Bluetooth para configurar la tarjeta BITalino.</li>
<li>Conectar la batería a la placa BITalino.</li>
<li>Encender la placa.
<div style="text-align: center;">
&lt;img srcLab4/Figura_4.jpeg” height=“300”&gt;
<p>
Figura 4. Manual de BiTalino [5]
</p></div>
</li></ol></section></section></section></section></section></section></section></section></main></div>
<li>Buscar la tarjeta BITalino.
<div style="text-align: center;">
<img src="./Lab4/Figura_5.jpeg" width="500">
<p>
Figura 5. Pantalla de Inicio OpenSignals
</p></div>
</li>
<li>Agregar el pin “1234” que se muestra en la guía de inicio rápido.</li>
<li>Una vez listo, aparecerá de color azul la opción Enable en OpenSignals, lo que indica que el BITalino está listo para usarse.</li>
<li>Conectar los cables a A2, que es el puerto para Electrocardiograma (ECG).</li>
<li>Colocar los electrodos en los cables y posicionarlos en el lugar de la medición.
<div style="text-align: center;">
<img src="./Lab4/Figura_6.jpeg" width="500">
<p>
Figura 6. Canales del BiTalino. Usamos A2 [5]
</p></div>
</li>


<section id="posicionamiento-de-los-electrodos" class="level3">
<h3>4.3 Posicionamiento de los electrodos</h3>
Se utilizó la guía de BITalino “BITalino HOME-GUIDE #2 Electrocardiography (ECG) Exploring Cardiac Signals at the Skin Surface”. Según el protocolo para la derivación I, se colocaron los electrodos en las muñecas y cresta ilíaca como se muestra en la figura 7.
<div style="text-align: center;">
<img src="./Lab4/Figura_7.jpeg" width="500">
<p>
Figura 7. Posicionamiento de electrodos para la derivación I: IN+ (rojo) e IN-(negro) en las muñecas, REF (blanco) en la cresta iliaca [5]
</p></div>
<table class="caption-top table">
<thead>
<tr class="header">
<th>ELECTRODO</th>
<th>COLOR</th>
<th>POSICIÓN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Referencia</td>
<td>Blanco</td>
<td>Cresta Ilíaca</td>
</tr>
<tr class="even">
<td>Positivo</td>
<td>Negro</td>
<td>Muñeca derecha</td>
</tr>
<tr class="odd">
<td>Negativo</td>
<td>Rojo</td>
<td>Muñeca izquierda</td>
</tr>
</tbody>
</table>
<section id="protocolo" class="level3">
<h3 data-anchor-id="protocolo">4.4 Protocolo</h3>
<ol type="1">
<li>Se grabó durante 30 segundos con el usuario sin movimientos (reposo).</li>
<li>Se realizó 3 veces un ejercicio de inhalación - exhalación manteniendo cada estado por 5 segundos.</li>
<li>Se grabó por 30 segundos luego de las respiraciones.</li>
<li>Se realizaron 2 repeticiones de 10 Burpees salto de rana.</li>
<li>Se grabó por 30 segundos luego del ejercicio.</li>
<li>Se realizaron inhalaciones profundas (10 segundos), luego se mantuvo la respiración (10 segundos) para finalmente exhalar (10 segundos).</li>
</ol>
</section>
<section id="resultados" class="level2">
<h2 data-anchor-id="resultados">Resultados</h2>
<section id="conexión-usada" class="level3">
<h3>5.1 Conexión usada</h3>
De acuerdo a la guía mencionada se colocaron los electrodos de la siguiente manera:
<div style="text-align: center;">
<img src="./Lab4/Figura_8.jpeg" width="500">
<p>
Figura 8. Posición de los electrodos
</p></div>
<div style="text-align: center;">
<img src="./Lab4/Figura_9.jpeg" width="500">
<p>
Figura 9. Conexión de los electrodos con el BITalino
</p></div>
<section id="video-de-la-señal-y-ploteo-de-la-señal-en-opensignal" class="level3">
<h3 data-anchor-id="video-de-la-señal-y-ploteo-de-la-señal-en-opensignal">5.2 Video de la señal y ploteo de la señal en OpenSignal</h3>
<ol type="1">
<li><strong>Grabación de Baseline Inicial (30 segundos) - Estado: Reposo y Respiración Normal:</strong> El sujeto de prueba mantuvo una respiración normal y tranquila, con baja interferencias y sin movimientos.
<div style="text-align: center;">
<p><a href="https://youtu.be/hSLyqPwil7Q"> <img src="https://img.youtube.com/vi/hSLyqPwil7Q/mqdefault.jpg" width="400" height="225"> </a></p>
</div></li>
<li><strong>Grabación Después del Ciclo de Respiración (30 segundos) - Estado: Pre-Ejercicio Respiratorio:</strong> El sujeto de prueba realizó el ciclo de inhalación-sostener-exhalación-sostener tres veces, ejerció un esfuerzo respiratorio controlado.
<div style="text-align: center;">
<p><a href="https://youtu.be/TwwWVFxxOTI"> <img src="https://img.youtube.com/vi/TwwWVFxxOTI/mqdefault.jpg" width="400" height="225"> </a></p>
</div></li>
<li><strong>Grabación Después del Ejercicio (30 segundos) - Estado: Post-Ejercicio Intenso:</strong> El sujeto de prueba realizó 2 repeticiones de 10 burpees.
<div style="text-align: center;">
<p><a href="https://youtu.be/7clrUu7CCzI"> <img src="https://img.youtube.com/vi/7clrUu7CCzI/mqdefault.jpg" width="400" height="225"> </a></p>
</div></li>
<li><strong>Grabación Después de la Retención de la Respiración (30 segundos) - Estado: Post-Retención Respiratoria:</strong> El sujeto de prueba realizó una inhalación prolongada seguida de una retención de la respiración.
<div style="text-align: center;">
<p><a href="https://youtu.be/6NPQbbjay3I"> <img src="https://img.youtube.com/vi/6NPQbbjay3I/mqdefault.jpg" width="400" height="225"> </a></p>
</div></li>
</ol>
</section>
<section id="ploteo-de-la-señal-en-python" class="level3">
<h3 data-anchor-id="ploteo-de-la-señal-en-python">5.3 Ploteo de la señal en Python</h3>
De acuerdo a la data adquirida de OpenSignals se plotearon las señales ECG para cada caso descrito. Se observó una mayor frecuencia cardiaca luego de que el usuario realizara el ejercicio a comparación del estado inicial en reposo. - ECG - Reposo
<div style="display: flex; justify-content: center;">
<p><img src="./Lab4/Ploteos_Py/5_ECG_RespiraciónNormal_Reposo.png" width="500"> <img src="./Lab4/Ploteos_Py/5_ECG_Reposo_FRECUENCIA.png" width="500"></p>
</div>
<p style="text-align: center;">
Gráfica 1. Gráficas de ECG y FFT de Reposo
</p>
<ul>
<li>ECG - Después de la respiraciones profundas
<div style="display: flex; justify-content: center;">
<p><img src="./Lab4/Ploteos_Py/6_ECG_DespuesRespiracionesSostenidas.png" width="500"> <img src="./Lab4/Ploteos_Py/6_ECG_DespResp_FRECUENCIA.png" width="500"></p>
</div>
<p style="text-align: center;">
Gráfica 2. Gráficas de ECG y FFT de Respiraciones Profundas
</p></li>
<li>ECG - Después de Burpees (ejercicio)
<div style="display: flex; justify-content: center;">
<p><img src="./Lab4/Ploteos_Py/7_ECG_DespuesBurpees.png" width="500"> <img src="./Lab4/Ploteos_Py/8_ECG_RespDespBurpees_FRECUENCIA.png" width="500"></p>
</div>
<p style="text-align: center;">
Gráfica 3. Gráficas de ECG y FFT Después de Ejercicio
</p></li>
<li>ECG - Respiraciones después del ejercicio
<div style="display: flex; justify-content: center;">
<p><img src="./Lab4/Ploteos_Py/8_ECG_RespiracionesDespuesBurpees.png" width="500"> <img src="./Lab4/Ploteos_Py/8_ECG_RespDespBurpees_FRECUENCIA.png" width="500"></p>
</div>
<p style="text-align: center;">
Gráfica 4. Gráficas de ECG y FFT de Respiración después de Ejercicio
</p></li>
</ul>
<p>Todos los códigos en: <a href="../../../Software/Lab4">Códigos py</a> - Archivos de los datos de las señales txt: <br> <a href="../../../Documentacion/Laboratorios/Lab4/ECG_respiracion_normal.txt">Respiración Normal</a><br> <a href="../../../Documentacion/Laboratorios/Lab4/ECG_respiraciones_sostenidas.txt">Respiración Sostenida</a><br> <a href="../../../Documentacion/Laboratorios/Lab4/ECG_despues_ejercicio.txt">Después de Ejercicio</a><br> <a href="../../../Documentacion/Laboratorios/Lab4/ECG_respriacion_despues_ejercicio%20.txt">Respiración después de Ejercicio</a></p>
<p>Código de ejemplo:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PLOTEO SEÑAL ECG RESPIRACIONES DESPUÉS DEL EJERCICIO</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Importamos librerias </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Abrimos el archivo txt</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">"ECG_respiracion_despues_ejercicio.txt"</span>,<span class="st">"r"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> f.readline()  <span class="co"># con f.read() leemos todo el contenido</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>raw_data</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>Fs <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>Ts <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>Fs</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f" Fs = </span><span class="sc">{</span>Fs<span class="sc">}</span><span class="ss"> hz</span><span class="ch">\n</span><span class="ss"> Ts = </span><span class="sc">{</span>Ts<span class="sc">}</span><span class="ss"> s"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Leer el archivo excluyendo las 2 primeras filas </span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.genfromtxt(<span class="st">"./ECG_respiracion_despues_ejercicio.txt"</span>, skip_header <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#array[filas, columnas]</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>canalA2 <span class="op">=</span> array[:,<span class="dv">6</span>] <span class="co">#Todas las filas de la columna 6 -&gt; Canal A2 ECG</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Para conocer el número de filas</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> canalA2.shape[<span class="dv">0</span>] <span class="co">#shape devuelve una tupla con dimensiones del array</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> np.arange(<span class="dv">0</span>,M)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> n<span class="op">*</span>Ts <span class="co">#Vector de tiempo</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Ploteamos la lectura</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>plt.plot(t, canalA2, label<span class="op">=</span><span class="st">"señal"</span>)     </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>plt.grid(linestyle<span class="op">=</span><span class="st">":"</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ECG - Respiraciones después de Burpees"</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Tiempo (s)"</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Amplitud (mV)"</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">10</span>,<span class="dv">15</span>])</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Para saber la frecuencia de la señal debemos pasarlo al dominio de la frecuencia</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">2</span><span class="op">**</span><span class="dv">10</span>                                     <span class="co"># 10 bits, 0-1023</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>signal_fft <span class="op">=</span> np.fft.fft(canalA2, N)           <span class="co"># fft magtinud</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>signal_fft <span class="op">=</span> np.<span class="bu">round</span>(np.<span class="bu">abs</span>(signal_fft),<span class="dv">3</span>)[<span class="dv">0</span>:N<span class="op">//</span><span class="dv">2</span>] <span class="co"># nos quedamos con los componente de la derecha de la FFT</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>signal_aux <span class="op">=</span> signal_fft<span class="op">/</span>signal_fft.<span class="bu">max</span>()     <span class="co"># hallamos el maximo para pasar la magnitud a escala db</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">'ignore'</span>):</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    signal_fft_db <span class="op">=</span> <span class="dv">10</span><span class="op">*</span>np.log10(signal_aux)  <span class="co"># , out=signal_aux, where=signal_aux &gt;= 0 para evitar division por zero</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>F_list <span class="op">=</span> np.linspace(<span class="dv">0</span>,Fs<span class="op">/</span><span class="dv">2</span>, N<span class="op">//</span><span class="dv">2</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>F <span class="op">=</span> np.<span class="bu">round</span>(F_list[np.argmax(signal_fft_db)], <span class="dv">1</span>)   <span class="co"># argmax, encuentra el argumento max en un array</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>plt.plot(F_list, signal_fft_db)  <span class="co">#10 * np.log10(P / Pref) , decibelios</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>plt.text(F,<span class="dv">0</span>, <span class="ss">f"</span><span class="sc">{</span>F<span class="sc">}</span><span class="ss">Hz"</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>plt.grid(linestyle<span class="op">=</span><span class="st">":"</span>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Magnitud (db)"</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Frecuencia (Hz)"</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"FFT en el decibelios"</span>)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>,<span class="dv">200</span>])</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.xticks(np.arange(0,200,10))</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="señal-de-simulación-de-paro-cardiaco---prosim-4" class="level3">
<h3>5.4 Señal de simulación de paro cardiaco - ProSim 4</h3>
<strong>Conexión usada:</strong>
<div style="text-align: center;">
<img src="./Lab4/Figura_10.jpeg" height="400">
<p>
Figura 10. Conexión de SimPro con el BITalino
</p></div>
<strong>Video de la señal y ploteo de la señal en OpenSignal:</strong> 1. <strong>Grabación de la Contracción Ventricular Prematura (CVP) - ECG</strong>: La grabación muestra la actividad eléctrica del corazón durante la presencia de una contracción ventricular prematura (CVP), que es un tipo de anomalía cardíaca.
<div style="text-align: center;">
<pre><code> &lt;a href="https://youtu.be/o_2J0r7f2XY"&gt;
   &lt;img src="https://img.youtube.com/vi/o_2J0r7f2XY/mqdefault.jpg" width="400" height="225"&gt;
 &lt;/a&gt;</code></pre>
</div>
<ol start="2" type="1">
<li><strong>Grabación de la Taquicardia Ventricular - ECG</strong>: Esta grabación muestra un electrocardiograma que indica taquicardia ventricular, una arritmia cardíaca caracterizada por un ritmo cardíaco rápido y anormal que comienza en los ventrículos del corazón.
<div style="text-align: center;">
<p><a href="https://youtu.be/XNoQcYaHo2o"> <img src="https://img.youtube.com/vi/XNoQcYaHo2o/mqdefault.jpg" width="400" height="225"> </a></p>
</div></li>
<li><strong>Grabación de la Fibrilación Ventricular Severa - ECG</strong>: Esta grabación muestra un electrocardiograma que indica fibrilación ventricular severa, una arritmia potencialmente mortal caracterizada por contracciones descoordinadas y rápidas de los ventrículos del corazón.
<div style="text-align: center;">
<p><a href="https://youtu.be/6HHVxNpfxvw"> <img src="https://img.youtube.com/vi/6HHVxNpfxvw/mqdefault.jpg" width="400" height="225"> </a></p>
</div></li>
<li><strong>Grabación de la Asistolia - ECG</strong>: Esta grabación muestra un electrocardiograma que indica asistolia, la ausencia total de actividad eléctrica y contracción muscular en el corazón, una forma extrema de paro cardíaco que requiere reanimación cardiopulmonar inmediata.
<div style="text-align: center;">
<p><a href="https://youtu.be/kOsHdmJgdE4"> <img src="https://img.youtube.com/vi/kOsHdmJgdE4/mqdefault.jpg" width="400" height="225"> </a></p>
</div></li>
</ol>
<section id="ploteo-de-la-señal-en-python-de-simulación-de-paro-cardiaco---prosim-4" class="level3">
<h3 data-anchor-id="ploteo-de-la-señal-en-python-de-simulación-de-paro-cardiaco---prosim-4">5.5 Ploteo de la señal en Python de simulación de paro cardiaco - ProSim 4</h3>
<p>De acuerdo a la data adquirida de OpenSignals se plotearon las señales ECG para cada paso. En este caso de simulador de paro cardiaco.</p>
<ul>
<li>ECG - Contracción Ventricular Prematura (CVP)
<div style="text-align: center;">
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/1_PASO2_CVP_PROSIM.png" &gt;</code></pre>
</div>
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/1_PASO2_FRECUENCIA.png" height="350"&gt;</code></pre>
</div>
</div></li>
</ul>
<p style="text-align: center;">
Gráfica 5. Gráficas de ECG y FFT de Contracción Ventricular Prematura
</p>
<ul>
<li>ECG - Taquicardia Ventricular 160 lpm
<div style="text-align: center;">
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/2_PASO3_TaquicardiaVentricular_PROSIM.png"&gt;</code></pre>
</div>
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/2_PASO3_FRECUENCIA.png" height="350"&gt;</code></pre>
</div>
</div>
<p style="text-align: center;">
Gráfica 6. Gráficas de ECG y FFT de Taquicardia Ventricular
</p></li>
<li>ECG - Fibrilación Ventricular Severa
<div style="text-align: center;">
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/3_PASO4_FibrilaciónVentricularSevera_PROSIM.png" &gt;</code></pre>
</div>
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/3_PASO4_FRECUENCIA.png" height="350" &gt;</code></pre>
</div>
</div>
<p style="text-align: center;">
Gráfica 7. Gráficas de ECG y FFT de Fibrilación Ventricular Severa
</p></li>
<li>ECG - Asistolia
<div style="text-align: center;">
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/4_PASO5_Asitolia_PROSIM.png" height="350"&gt;</code></pre>
</div>
<div>
<pre><code>&lt;img src="./Lab4/Ploteos_Py/4_PASO5_FRECUENCIA.png" height="350"&gt;</code></pre>
</div>
</div>
<p style="text-align: center;">
Gráfica 8. Gráficas de ECG y FFT de Asistolia
</p></li>
</ul>
<p>Todos los códigos en: <a href="../../../Software/Lab4">Códigos py</a> - Archivos de los datos de las señales txt: <br> <a href="../../../Documentacion/Laboratorios/Lab4/paso2_prosim.txt">ECG - CVP</a><br> <a href="../../../Documentacion/Laboratorios/Lab4/paso3_prosim.txt">ECG - Taquicardia</a><br> <a href="../../../Documentacion/Laboratorios/Lab4/paso4_prosim.txt">ECG - Fibrilación</a><br> <a href="../../../Documentacion/Laboratorios/Lab4/paso5_prosim.txt">ECG - Asistolia</a></p>
</section>
<section id="discusiones" class="level3">
<h3>5.6 Discusiones</h3>
<p>En la primera experiencia, al analizar la señal EKG durante la respiración normal, se observaron aproximadamente 7 pulsaciones en un lapso de 5 segundos, lo que equivale a una frecuencia cardíaca de alrededor de 84 pulsaciones por minuto. Este valor es consistente con una frecuencia cardíaca en reposo típica.</p>
<p>Después del ciclo completo de inhalación y exhalación, la señal EKG mostró aproximadamente 6 pulsaciones en 5 segundos, lo que corresponde a una frecuencia cardíaca de alrededor de 72 pulsaciones por minuto. Esta disminución en la frecuencia cardíaca esta relacionada con una adaptación fisiológica durante la respiración controlada.</p>
<p>En contraste, durante el ploteo de la señal EKG mientras se realizaba ejercicio, se observó un aumento significativo en la frecuencia cardíaca, con alrededor de 11 pulsaciones en 5 segundos, lo que se traduce en una frecuencia cardíaca de aproximadamente 132 pulsaciones por minuto. Este aumento es típico durante el ejercicio físico debido al aumento en la demanda metabólica del cuerpo.</p>
<p>Finalmente, después del ciclo de respiración controlada, la frecuencia cardíaca mostró una disminución notable, con alrededor de 8 pulsaciones en 5 segundos, lo que equivale a una frecuencia cardíaca de aproximadamente 96 pulsaciones por minuto.</p>
<p>Los resultados obtenidos a través del software del BITalino del experimento realizado para medir el Electrocardiograma (ECG) y utilizando el ProSim 4 de Fluke nos muestran las respuestas fisiológicas del cuerpo, específicamente las señales de los biopotenciales relacionados al sistema circulatorio, ante diferentes estímulos.</p>
<p><strong>Experiencia con el BITalino</strong><br> En la fase de reposo, se observaron ondas ECG normales del sujeto de prueba. Un ecg normal está formado por una onda P, un complejo QRS y una onda T [2]. Estos elementos que se pudieron identificar en este estado. También, se observa una frecuencia cardíaca, con poca variabilidad en la señal. Esto se utilizó para comparar las respuestas del corazón ante los estímulos posteriores [7].</p>
<p>Posteriormente se realizaron ejercicios de inhalación y exhalación controladas, se observaron cambios en el ECG asociada con la respiratoria. Durante la exhalación, el intervalo R-R que se observa en la Fig. x se alarga en comparación a la variación del intervalo durante la inhalación.</p>
<div style="text-align: center;">
<img src="./Lab4/Figura_11.jpeg" width="600">
<p>
Figura 11. ECG y trazado respiratorio profundo.
</p></div>
<p>Este fenómeno se conoce como arritmia sinusal respiratoria y se debe a la modulación del nodo sinoauricular por el sistema nervioso autónomo. Durante la inhalación, aumenta el tono simpático y disminuye el tono vagal, lo que acelera el ritmo cardíaco. Por otro lado, durante la exhalación, disminuye el tono simpático y aumenta el tono vagal, lo que desacelera el ritmo cardíaco [6]. <br> Posteriormente, tras la realización de los Burpees, se registró un aumento en la frecuencia cardíaca en el ECG. Se debe a que el corazón responde a la demanda metabólica de los músculos del cuerpo, por lo que aumenta su actividad [7]. <br><br></p>
<p><strong>Experiencia ProSim 4</strong> <br> Durante una Contracción Ventricular Prematura (PVC), se puede observar en el EKG la presencia de complejos QRS prematuros y anormales que aparecen antes de lo esperado en el ciclo cardíaco normal. Estos complejos QRS son más anchos y distintos en comparación con los complejos normales. Se observan 4 PCV en el ploteo de la señal, donde la mayoría estan precedidas por una onda P, pero no continua con una onda T, lo que puede indicar repolarización ventricular anormal.</p>
<p>En el caso de una Taquicardia Ventricular (TV), el EKG muestra una serie continua de complejos QRS anchos y regulares, se tienen alrededor de 53 pulsaciones en una duración de 20 segundos, lo que equivale a una frecuencia cardíaca aproximada de 160 latidos por minuto (lpm). En este paso, los complejos QRS en la TV son característicamente más anchos debido a la activación anormal de los ventrículos.</p>
<p>En el caso de una Fibrilación Ventricular (FV), el ploteo de la señal EKG muestra una actividad eléctrica caótica y desorganizada en los ventrículos, se aprecian una serie líneas o picos trazados de manera caotica y desordenada. No se observan complejos QRS definidos ni patrones claros de ondas P y T.</p>
<p>Finalmente, en el caso de la Asistolia, la señal EKG del ploteo muestra una línea casi plana con ligera presencia de ruido, indicando la ausencia total de actividad eléctrica efectiva en el corazón. Para este último paso, no se aprecian complejos QRS ni actividad eléctrica discernible en el trazado del ploteo.</p>
<section id="conclusiones" class="level2">
<h2 data-anchor-id="conclusiones">Conclusiones</h2>
<p>En esta experiencia, se exploró la actividad eléctrica del corazón mediante la mediciones del ECG en diferentes condiciones, utilizando un BITalino para registrar los datos y el ProSim 4 para simular un infarto. El BITalino es un dispositivo que permite obtener mediciones del ECG mediante su software OpenSignals. Mediante el software, se observaron gráficas del ECG en diferentes situaciones. Durante el reposo, se observaron patrones cardiacos normales, es decir, ritmos regulares y consistentes. Sin embargo, al realizar el ejercicio de respiración, se observó cambios en las señales del ECG, como la variabilidad del segmento R-R, que indica una respuesta fisiológica.</p>
<p>Al simular un infarto en el ProSim 4 de fluke, se pudo observar alteraciones en el ECG que indican daño cardiaco, como la elevación del segmento ST. Se resalta que el ECG puede ser utilizado para la detección de sutiles alteraciones de la actividad cardiaca y la importancia de la simulación para mejorar la comprensión de las patologías relacionadas [8].</p>
</section>
<section id="referencias" class="level2">
<h2 data-anchor-id="referencias">Referencias</h2>
<p>[1] Meu Vall d’Hebron. “Anatomía del corazón”. Hospital Universitario Vall d’Hebron. Accedido el 21 de abril de 2024. [En línea]. Disponible: https://hospital.vallhebron.com/es/asistencia/consejos-de-salud/anatomia-del-corazon#:~:text=El%20corazón%20está%20formado%20por,hay%20una%20válvula%20llamada%20auriculoventricular.</p>
<p>[2] Guyton, A. C., y J. E. Hall. 14ª Edición «El corazón». En Manual de fisiología médica. Madrid y Barcelona: McGraw-Hill, 2021, 115-127.</p>
<p>[3] UDMI. “Am I at Risk for Cardiovascular Disease? - University Diagnostic Medical Imaging”. University Diagnostic Medical Imaging. Accedido el 21 de abril de 2024. [En línea]. Disponible: https://www.udmi.net/cardiovascular-disease-risk/</p>
<p>[4] ECG and ECHO Learning. “ECG interpretation: Characteristics of the normal ECG (P-wave, QRS complex, ST segment, T-wave) – Cardiovascular Education”. Cardiovascular Education. Accedido el 21 de abril de 2024. [En línea]. Disponible: https://ecgwaves.com/topic/ecg-normal-p-wave-qrs-complex-st-segment-t-wave-j-point/</p>
<p>[5] ““BITalino (r)evolution Lab Guide.””. Support PLUX Biosignals official – Official PLUX support and biosignals knowledge base. Accedido el 21 de abril de 2024. [En línea]. Disponible: https://support.pluxbiosignals.com/wp-content/uploads/2022/04/HomeGuide5_ACC.pdf</p>
<p>[6] ​​C. J. Levin, S. J. Swoap, “The impact of deep breathing and alternate nostril breathing on heart rate variability: a human physiology laboratory,” Advances in Physiology Education, vol.&nbsp;43, no. 3, pp.&nbsp;270-276, 2019.</p>
<p>[7] E. M. Rad et al., “Exercise-induced electrocardiographic changes after treadmill exercise testing in healthy children: A comprehensive study,” Annals of Pediatric Cardiology, vol.&nbsp;14, no. 4, pp.&nbsp;449-458, 2021.</p>
<p>[8] Ribeiro, A.H., Ribeiro, M.H., Paixão, G.M.M. et al., “Automatic diagnosis of the 12-lead ECG using a deep neural network,” Nat Commun, vol.&nbsp;11, no. 1, p.&nbsp;1760, Apr.&nbsp;2020. [Online]. Available: https://doi.org/10.1038/s41467-020-15432-4.</p>
</section>

</section>

</section>


</section>
</section>

</section>












<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
 <!-- /content -->




</body></html>